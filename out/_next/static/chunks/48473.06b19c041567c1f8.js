"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[48473,14643],{14643:function(e,t,i){i.r(t),i.d(t,{signLoginPayload:function(){return a}});async function a(e){let{payload:t,account:i}=e;return{signature:await i.signMessage({message:function(e){let t=["".concat(e.domain," wants you to sign in with your ").concat("Ethereum"," account:"),e.address].join("\n");t=[t,e.statement].join("\n\n"),e.statement&&(t+="\n");let i=[];if(e.uri){let t="URI: ".concat(e.uri);i.push(t)}let a="Version: ".concat(e.version);if(i.push(a),e.chain_id){let t="Chain ID: ".concat(e.chain_id)||0;i.push(t)}let n="Nonce: ".concat(e.nonce);i.push(n);let r="Issued At: ".concat(e.issued_at);i.push(r);let s="Expiration Time: ".concat(e.expiration_time);if(i.push(s),e.invalid_before){let t="Not Before: ".concat(e.invalid_before);i.push(t)}return e.resources&&i.push(["Resources:",...e.resources.map(e=>"- ".concat(e))].join("\n")),[t,i.join("\n")].join("\n")}(t)}),payload:t}}},50276:function(e,t,i){i.d(t,{n:function(){return a}});async function a(e,t){return await e({method:"eth_sendRawTransaction",params:[t]})}},48473:function(e,t,i){i.r(t),i.d(t,{InAppWebConnector:function(){return z}});var a=i(18525),n=i(1029),r=i(23565),s=i(33060);async function o(e){let t=(0,r.NX)(e.client,e.ecosystem);return await (async()=>{let i=(0,s.o)({authOption:"guest",client:e.client,ecosystem:e.ecosystem}),a=await t("".concat(i),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:"guest"})});if(!a.ok)throw Error("Failed to generate guest account");return await a.json()})()}var l=i(71631);function c(){return"".concat((0,a.TS)("inAppWallet"),"/api/2024-05-05/login/passkey/callback")}function d(e,t){return"".concat((0,a.TS)("inAppWallet"),"/api/2024-05-05/login/passkey?type=").concat(e).concat(t?"&username=".concat(t):"")}async function u(e){var t,i,a,n,s,o,u;if(!e.passkeyClient.isAvailable())throw Error("Passkeys are not available on this device");let h=new l.A({storage:e.storage,clientId:e.client.clientId,ecosystemId:null===(t=e.ecosystem)||void 0===t?void 0:t.id}),p=(0,r.NX)(e.client,e.ecosystem),m=null!==(n=e.username)&&void 0!==n?n:(o=e.ecosystem,"".concat(null!==(u=null==o?void 0:o.id)&&void 0!==u?u:"wallet","-").concat(new Date().toISOString())),y=await p(d("sign-up",m)),g=await y.json();if(!g.challenge)throw Error("No challenge received");let w=g.challenge,f=await e.passkeyClient.register({name:m,challenge:w,rp:e.rp}),v={};(null===(i=e.ecosystem)||void 0===i?void 0:i.partnerId)&&(v["x-ecosystem-partner-id"]=e.ecosystem.partnerId),(null===(a=e.ecosystem)||void 0===a?void 0:a.id)&&(v["x-ecosystem-id"]=e.ecosystem.id);let b=await p(c(),{method:"POST",headers:{"Content-Type":"application/json",...v},body:JSON.stringify({type:"sign-up",authenticatorData:f.authenticatorData,credentialId:f.credentialId,serverVerificationId:g.serverVerificationId,clientData:f.clientData,username:m,credential:{publicKey:f.credential.publicKey,algorithm:f.credential.algorithm},origin:f.origin,rpId:e.rp.id})}),I=await b.json();if(!I||!I.storedToken)throw Error("Error verifying passkey: ".concat(null!==(s=I.message)&&void 0!==s?s:"unknown error"));return await h.savePasskeyCredentialId(f.credentialId),I}async function h(e){var t,i,a,n,s;if(!e.passkeyClient.isAvailable())throw Error("Passkeys are not available on this device");let o=new l.A({storage:e.storage,clientId:e.client.clientId,ecosystemId:null===(t=e.ecosystem)||void 0===t?void 0:t.id}),u=(0,r.NX)(e.client,e.ecosystem),h=await u(d("sign-in")),p=await h.json();if(!p.challenge)throw Error("No challenge received");let m=p.challenge,y=null!==(n=await o.getPasskeyCredentialId())&&void 0!==n?n:void 0,g=await e.passkeyClient.authenticate({credentialId:y,challenge:m,rp:e.rp}),w={};(null===(i=e.ecosystem)||void 0===i?void 0:i.partnerId)&&(w["x-ecosystem-partner-id"]=e.ecosystem.partnerId),(null===(a=e.ecosystem)||void 0===a?void 0:a.id)&&(w["x-ecosystem-id"]=e.ecosystem.id);let f=await u(c(),{method:"POST",headers:{"Content-Type":"application/json",...w},body:JSON.stringify({type:"sign-in",authenticatorData:g.authenticatorData,credentialId:g.credentialId,serverVerificationId:p.serverVerificationId,clientData:g.clientData,signature:g.signature,origin:g.origin,rpId:e.rp.id})}),v=await f.json();if(!v||!v.storedToken)throw Error("Error verifying passkey: ".concat(null!==(s=v.message)&&void 0!==s?s:"unknown error"));return await o.savePasskeyCredentialId(g.credentialId),v}var p=i(14643);async function m(e){let{wallet:t,chain:i}=e,a=await t.connect({client:e.client}),n=(0,r.NX)(e.client,e.ecosystem),o=await (async()=>{let t=(0,s.Z)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),r=await n("".concat(t,"&address=").concat(a.address,"&chainId=").concat(i.id));if(!r.ok)throw Error("Failed to generate SIWE login payload");return await r.json()})(),{signature:l}=await (0,p.signLoginPayload)({payload:o,account:a});return await (async()=>{let t=(0,s.o)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),i=await n("".concat(t,"&signature=").concat(l,"&payload=").concat(encodeURIComponent(o)),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signature:l,payload:o})});if(!i.ok)throw Error("Failed to verify SIWE signature");return await i.json()})()}var y=i(4428);async function g(e){let{authToken:t,client:i,ecosystem:n}=e,s=(0,r.NX)(i,n),o=await s("".concat((0,a.TS)("inAppWallet"),"/api/2024-05-05/accounts"),{method:"GET",headers:{"Content-Type":"application/json","x-thirdweb-client-id":i.clientId,Authorization:"Bearer embedded-wallet-token:".concat(t)}});if(!o.ok){if(401===o.status)return;let e=await o.json();throw Error("Failed to get user status: ".concat(e.error))}return await o.json()}var w=i(46711);function f(e){return new Promise(t=>{setTimeout(t,1e3*e)})}let v={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none",pointerEvents:"all"},b=new Map;class I{async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{var i;let a=new MessageChannel,n=new Promise((i,n)=>{a.port1.onmessage=r=>{let{data:s}=r;a.port1.close(),s.success||n(Error(s.error)),b.set(e.src,!0),t&&t(),i(!0)}});null==e||null===(i=e.contentWindow)||void 0===i||i.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2]),await n}}async call(e){var t;let{procedureName:i,params:a,showIframe:n=!1}=e;for(;!b.get(this.iframe.src);)await f(this.POLLING_INTERVAL_SECONDS);n&&(this.iframe.style.display="block",await f(.005));let r=new MessageChannel,s=new Promise((e,t)=>{r.port1.onmessage=async i=>{let{data:a}=i;r.port1.close(),n&&(await f(.1),this.iframe.style.display="none"),a.success?e(a.data):t(Error(a.error))}});return null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage({eventType:i,data:a},this.iframeBaseUrl,[r.port2]),s}destroy(){b.delete(this.iframe.src)}constructor({link:e,baseUrl:t,iframeId:i,container:a=document.body,onIframeInitialize:n}){Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.iframeBaseUrl=t;let r=document.getElementById(i),s=new URL(e);if(!r||r.src!==s.href){r=document.createElement("iframe");let e={...v};Object.assign(r.style,e),r.setAttribute("id",i),r.setAttribute("fetchpriority","high"),a.appendChild(r),r.src=s.href;let t=e=>{if("ewsIframeLoaded"===e.data.eventType){if(window.removeEventListener("message",t),!r){console.warn("thirdweb iFrame not found");return}this.onIframeLoadHandler(r,n)()}};window.addEventListener("message",t)}this.iframe=r}}class L extends I{async onIframeLoadedInitVariables(){var e,t,i;let a=new l.A({storage:n.x,clientId:this.clientId,ecosystemId:null===(e=this.ecosystem)||void 0===e?void 0:e.id});return{authCookie:await a.getAuthCookie(),deviceShareStored:await a.getDeviceShare(),walletUserId:await a.getWalletUserId(),clientId:this.clientId,partnerId:null===(t=this.ecosystem)||void 0===t?void 0:t.partnerId,ecosystemId:null===(i=this.ecosystem)||void 0===i?void 0:i.id}}constructor({clientId:e,baseUrl:t,ecosystem:i}){super({iframeId:E+((null==i?void 0:i.id)||""),link:function(e){let{clientId:t,baseUrl:i,path:a,ecosystem:n,queryParams:r}=e,s=new URL("".concat(a),i);if(r)for(let e of Object.keys(r)){var o;s.searchParams.set(e,(null===(o=r[e])||void 0===o?void 0:o.toString())||"")}return s.searchParams.set("clientId",t),(null==n?void 0:n.partnerId)!==void 0&&s.searchParams.set("partnerId",n.partnerId),(null==n?void 0:n.id)!==void 0&&s.searchParams.set("ecosystemId",n.id),s}({clientId:e,path:w.hD,ecosystem:i,baseUrl:t}).href,baseUrl:t,container:document.body}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.clientId=e,this.ecosystem=i}}let E="thirdweb-in-app-wallet-iframe";async function k(e){let{authToken:t,client:i,ecosystem:n}=e,s=(0,r.NX)(i,n),o=await s("".concat((0,a.TS)("inAppWallet"),"/api/v1/enclave-wallet/generate"),{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":i.clientId,Authorization:"Bearer embedded-wallet-token:".concat(t)}});if(!o.ok)throw Error("Failed to generate wallet");let{wallet:l}=await o.json();return l}class O{async sendEmailLoginOtp(e){let{email:t}=e;return await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:t}})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return await this.LoginQuerier.call({procedureName:"sendThirdwebSmsLoginOtp",params:{phoneNumber:t}})}constructor({baseUrl:e,querier:t,preLogin:i,postLogin:a,client:n,ecosystem:r}){Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=e,this.LoginQuerier=t,this.preLogin=i,this.postLogin=a,this.client=n,this.ecosystem=r}}class T extends O{async authenticateWithModal(){return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0})}async loginWithModal(){await this.preLogin();let e=await this.authenticateWithModal();return this.postLogin(e)}async authenticateWithIframe(e){let{email:t}=e;return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:t},showIframe:!0})}async loginWithIframe(e){let{email:t}=e;await this.preLogin();let i=await this.authenticateWithIframe({email:t});return this.postLogin(i)}async authenticateWithCustomJwt(e){let{encryptionKey:t,jwt:i}=e;if(!t||0===t.length)throw Error("Encryption key is required for custom jwt auth");return this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:t,jwt:i}})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:i}=e;if(!t||0===t.length)throw Error("Encryption key is required for custom jwt auth");await this.preLogin();let a=await this.authenticateWithCustomJwt({encryptionKey:t,jwt:i});return this.postLogin(a)}async authenticateWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:i}=e;return this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:t,payload:i}})}async loginWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:i}=e;if(!t||0===t.length)throw Error("Encryption key is required for custom auth");await this.preLogin();let a=await this.authenticateWithCustomAuthEndpoint({encryptionKey:t,payload:i});return this.postLogin(a)}async authenticateWithEmailOtp(e){let{email:t,otp:i,recoveryCode:a}=e;return this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:t,otp:i,recoveryCode:a}})}async loginWithEmailOtp(e){let{email:t,otp:i,recoveryCode:a}=e,n=await this.authenticateWithEmailOtp({email:t,otp:i,recoveryCode:a});return this.postLogin(n)}async authenticateWithSmsOtp(e){let{phoneNumber:t,otp:i,recoveryCode:a}=e;return this.LoginQuerier.call({procedureName:"verifyThirdwebSmsLoginOtp",params:{phoneNumber:t,otp:i,recoveryCode:a}})}async loginWithSmsOtp(e){let{phoneNumber:t,otp:i,recoveryCode:a}=e,n=await this.authenticateWithSmsOtp({phoneNumber:t,otp:i,recoveryCode:a});return this.postLogin(n)}}class W{async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:i}=e;return t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString),await this.onAuthSuccess({storedToken:t,walletDetails:i})}async loginWithAuthToken(e,t){var i;await this.preLogin();let a=await g({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});if(!a)throw Error("Cannot login, no user found for auth token");if(a.wallets.length>0&&(null===(i=a.wallets[0])||void 0===i?void 0:i.type)==="enclave")return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:a.wallets[0].address}});if(0===a.wallets.length&&this.ecosystem){let t=await k({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:t.address}})}let n=await this.AuthQuerier.call({procedureName:"loginWithStoredTokenDetails",params:{storedToken:e.storedToken,recoveryCode:t}});return this.postLogin(n)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async authenticateWithModal(){return this.BaseLogin.authenticateWithModal()}async loginWithIframe(e){return this.BaseLogin.loginWithIframe(e)}async authenticateWithIframe(e){return this.BaseLogin.authenticateWithIframe(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async authenticateWithCustomJwt(e){return this.BaseLogin.authenticateWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async authenticateWithCustomAuthEndpoint(e){return this.BaseLogin.authenticateWithCustomAuthEndpoint(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return this.BaseLogin.sendSmsLoginOtp({phoneNumber:t})}async loginWithEmailOtp(e){return await this.preLogin(),this.BaseLogin.loginWithEmailOtp(e)}async authenticateWithEmailOtp(e){return this.BaseLogin.authenticateWithEmailOtp(e)}async loginWithSmsOtp(e){return await this.preLogin(),this.BaseLogin.loginWithSmsOtp(e)}async authenticateWithSmsOtp(e){return this.BaseLogin.authenticateWithSmsOtp(e)}async logout(){let e=await this.localStorage.removeAuthCookie(),t=await this.localStorage.removeWalletUserId();return{success:e||t}}constructor({client:e,querier:t,onAuthSuccess:i,ecosystem:a,baseUrl:r}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=a,this.AuthQuerier=t,this.localStorage=new l.A({storage:n.x,clientId:e.clientId,ecosystemId:null==a?void 0:a.id}),this.onAuthSuccess=i,this.BaseLogin=new T({postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},ecosystem:a,querier:t,client:e,baseUrl:r})}}var S=i(82484);let A=async e=>{let{client:t,ecosystem:i}=e,a=(0,s.Z)({client:t,ecosystem:i,authOption:e.strategy}),n={"Content-Type":"application/json","x-client-id":t.clientId};(null==i?void 0:i.id)&&(n["x-ecosystem-id"]=i.id),(null==i?void 0:i.partnerId)&&(n["x-ecosystem-partner-id"]=i.partnerId);let r=(()=>{switch(e.strategy){case"email":return{email:e.email};case"phone":return{phone:e.phoneNumber}}})(),o=await fetch(a,{method:"POST",headers:n,body:JSON.stringify(r)});if(!o.ok)throw Error("Failed to send verification code");return await o.json()},N=async e=>{let{client:t,ecosystem:i}=e,a=(0,s.o)({authOption:e.strategy,client:e.client,ecosystem:e.ecosystem}),n={"Content-Type":"application/json","x-client-id":t.clientId};(null==i?void 0:i.id)&&(n["x-ecosystem-id"]=i.id),(null==i?void 0:i.partnerId)&&(n["x-ecosystem-partner-id"]=i.partnerId);let r=(()=>{switch(e.strategy){case"email":return{email:e.email,code:e.verificationCode};case"phone":return{phone:e.phoneNumber,code:e.verificationCode}}})(),o=await fetch(a,{method:"POST",headers:n,body:JSON.stringify(r)});if(!o.ok)throw Error("Failed to verify verification code");return await o.json()};var P=i(15578),C=i(85738),j=i(50276),D=i(90874),x=i(83286),_=i(14520),G=i(24053);async function U(e,t){return new l.A({storage:n.x,clientId:e.clientId,ecosystemId:null==t?void 0:t.id}).getAuthCookie()}async function B(e){let{client:t,ecosystem:i,payload:{message:n,isRaw:s}}=e,o=(0,r.NX)(t,i),l=await U(t,i),c=await o("".concat((0,a.TS)("inAppWallet"),"/api/v1/enclave-wallet/sign-message"),{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":t.clientId,Authorization:"Bearer embedded-wallet-token:".concat(l)},body:JSON.stringify({messagePayload:{message:n,isRaw:s}})});if(!c.ok)throw Error("Failed to sign message");return await c.json()}async function F(e){let{client:t,ecosystem:i,payload:n}=e;console.log("payload",n);let s=(0,r.NX)(t,i),o=await U(t,i),l=await s("".concat((0,a.TS)("inAppWallet"),"/api/v1/enclave-wallet/sign-transaction"),{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":t.clientId,Authorization:"Bearer embedded-wallet-token:".concat(o)},body:JSON.stringify({transactionPayload:n})});if(!l.ok)throw Error("Failed to sign transaction");return(await l.json()).signature}async function M(e){let{client:t,ecosystem:i,payload:n}=e,s=(0,r.NX)(t,i),o=await U(t,i),l=await s("".concat((0,a.TS)("inAppWallet"),"/api/v1/enclave-wallet/sign-typed-data"),{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":t.clientId,Authorization:"Bearer embedded-wallet-token:".concat(o)},body:JSON.stringify({...n})});if(!l.ok)throw Error("Failed to sign typed data");return await l.json()}class J{async postWalletSetUp(e){let{walletAddress:t,authToken:i}=e;return await this.localStorage.saveAuthCookie(i),{walletAddress:t}}async getUserWalletStatus(){var e,t;let i=await this.localStorage.getAuthCookie();if(!i)return{status:y.Nx.LOGGED_OUT};let a=await g({authToken:i,client:this.client,ecosystem:this.ecosystem});if(!a)return{status:y.Nx.LOGGED_OUT};let n=a.wallets[0],r={email:null===(e=a.linkedAccounts.find(e=>void 0!==e.details.email))||void 0===e?void 0:e.details.email,phoneNumber:null===(t=a.linkedAccounts.find(e=>void 0!==e.details.phone))||void 0===t?void 0:t.details.phone,userWalletId:a.id||"",recoveryShareManagement:y.pw.ENCLAVE};return n?{status:y.Nx.LOGGED_IN_WALLET_INITIALIZED,walletAddress:n.address,authDetails:r,account:await this.getAccount()}:{status:y.Nx.LOGGED_IN_WALLET_UNINITIALIZED,authDetails:r}}async getAccount(){let e=this.client,t=this.ecosystem,a=async a=>{var n;let r=(0,D.getRpcClient)({client:e,chain:(0,C.XY)(a.chainId)}),s={to:null!==(n=a.to)&&void 0!==n?n:void 0,data:a.data?(0,_.NC)(a.data):void 0,value:a.value?(0,_.NC)(a.value):void 0,gas:a.gas?(0,_.NC)(a.gas+a.gas/BigInt(10)):void 0,nonce:a.nonce?(0,_.NC)(a.nonce):(0,_.NC)(await i.e(68250).then(i.bind(i,68250)).then(e=>{let{eth_getTransactionCount:t}=e;return t(r,{address:this.address,blockTag:"pending"})})),chainId:(0,_.NC)(a.chainId)};return a.maxFeePerGas?(s.maxFeePerGas=(0,_.NC)(a.maxFeePerGas),s.maxPriorityFeePerGas=a.maxPriorityFeePerGas?(0,_.NC)(a.maxPriorityFeePerGas):void 0,s.type=2):(s.gasPrice=a.gasPrice?(0,_.NC)(a.gasPrice):void 0,s.type=0),F({client:e,ecosystem:t,payload:s})};return{address:(0,x.Kn)(this.address),async signTransaction(e){if(!e.chainId)throw Error("chainId required in tx to sign");return a({chainId:e.chainId,...e})},async sendTransaction(t){let i=(0,D.getRpcClient)({client:e,chain:(0,C.XY)(t.chainId)}),n=await a(t);return{transactionHash:await (0,j.n)(i,n)}},async signMessage(i){let{message:a}=i,n="string"==typeof a?{message:a,isRaw:!1}:{message:"string"==typeof a.raw?a.raw:(0,P.ci)(a.raw),isRaw:!0},{signature:r}=await B({client:e,ecosystem:t,payload:n});return r},async signTypedData(i){let a=(0,G.t)(i),{signature:n}=await M({client:e,ecosystem:t,payload:a});return n}}}constructor({client:e,ecosystem:t,address:i}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"address",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=t,this.address=i,this.localStorage=new l.A({storage:n.x,clientId:e.clientId,ecosystemId:null==t?void 0:t.id})}}class Q{async postWalletSetUp(e){if("isIframeStorageEnabled"in e)return e.isIframeStorageEnabled||await this.localStorage.saveDeviceShare(e.deviceShareStored,e.walletUserId),{walletAddress:e.walletAddress};throw Error("Invalid postWalletSetUp props")}async getUserWalletStatus(){let e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===y.Nx.LOGGED_IN_WALLET_INITIALIZED?{status:y.Nx.LOGGED_IN_WALLET_INITIALIZED,...e.user,account:await this.getAccount()}:e.status===y.Nx.LOGGED_IN_NEW_DEVICE||e.status===y.Nx.LOGGED_IN_WALLET_UNINITIALIZED?{status:y.Nx.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async getAccount(){var e;let t=this.walletManagerQuerier,i=this.client,n=null===(e=this.ecosystem)||void 0===e?void 0:e.partnerId,{address:r}=await t.call({procedureName:"getAddress",params:void 0}),s=async e=>{var i;let r={to:null!==(i=e.to)&&void 0!==i?i:void 0,data:e.data,value:e.value,gasLimit:e.gas,nonce:e.nonce,chainId:e.chainId};e.maxFeePerGas?(r.accessList=e.accessList,r.maxFeePerGas=e.maxFeePerGas,r.maxPriorityFeePerGas=e.maxPriorityFeePerGas,r.type=2):(r.gasPrice=e.gasPrice,r.type=0);let s=(0,a.gc)().rpc,{signedTransaction:o}=await t.call({procedureName:"signTransaction",params:{transaction:r,chainId:e.chainId,partnerId:n,rpcEndpoint:"https://".concat(e.chainId,".").concat(s)}});return o};return{address:(0,x.Kn)(r),async signTransaction(e){if(!e.chainId)throw Error("chainId required in tx to sign");return s({...e,chainId:e.chainId})},async sendTransaction(e){let t=(0,D.getRpcClient)({client:i,chain:(0,C.XY)(e.chainId)}),a=await s(e);return{transactionHash:await (0,j.n)(t,a)}},async signMessage(e){let{message:i}=e,a="string"==typeof i?i:i.raw instanceof Uint8Array?i.raw:(0,_.rR)(i.raw),{signedMessage:r}=await t.call({procedureName:"signMessage",params:{message:a,partnerId:n,chainId:1}});return r},async signTypedData(e){var i;let r=(0,G.t)(e);(null===(i=r.types)||void 0===i?void 0:i.EIP712Domain)&&(r.types.EIP712Domain=void 0);let s=r.domain,o=null==s?void 0:s.chainId,l={...(null==s?void 0:s.verifyingContract)?{verifyingContract:null==s?void 0:s.verifyingContract}:{},name:null==s?void 0:s.name,version:null==s?void 0:s.version};o&&(l.chainId=o);let c=(0,a.gc)().rpc,{signedTypedData:d}=await t.call({procedureName:"signTypedDataV4",params:{domain:l,types:r.types,message:r.message,chainId:o||1,partnerId:n,rpcEndpoint:"https://".concat(o,".").concat(c)}});return d}}}constructor({client:e,ecosystem:t,querier:i}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=t,this.walletManagerQuerier=i,this.localStorage=new l.A({storage:n.x,clientId:e.clientId,ecosystemId:null==t?void 0:t.id})}}class z{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}async initializeWallet(e){let t=await U(this.client,this.ecosystem);if(!e&&null===t)throw Error("No auth token provided and no stored auth token found to initialize the wallet");let i=await g({authToken:e||t,client:this.client,ecosystem:this.ecosystem});if(!i)throw Error("Cannot initialize wallet, no user logged in");if(0===i.wallets.length)throw Error("Cannot initialize wallet, this user does not have a wallet generated yet");if("enclave"===i.wallets[0].type){this.wallet=new J({client:this.client,ecosystem:this.ecosystem,address:i.wallets[0].address});return}this.wallet=new Q({client:this.client,ecosystem:this.ecosystem,querier:this.querier})}async getUser(){if(!this.wallet){let e=await U(this.client,this.ecosystem);if(!e)return{status:y.Nx.LOGGED_OUT};await this.initializeWallet(e)}if(!this.wallet)throw Error("Wallet not initialized");return await this.wallet.getUserWalletStatus()}getAccount(){if(!this.wallet)throw Error("Wallet not initialized");return this.wallet.getAccount()}async preAuthenticate(e){return A({...e,client:this.client,ecosystem:this.ecosystem})}authenticateWithRedirect(e,t,i){(0,S.Z)({authOption:e,client:this.client,ecosystem:this.ecosystem,redirectUrl:i,mode:t})}async loginWithAuthToken(e){return this.auth.loginWithAuthToken(e)}async authenticate(e){let t=e.strategy;switch(t){case"email":case"phone":return N({...e,client:this.client,ecosystem:this.ecosystem});case"jwt":return this.auth.authenticateWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"passkey":return this.passkeyAuth(e);case"auth_endpoint":return this.auth.authenticateWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.authenticateWithIframe({email:e.email});case"iframe":return this.auth.authenticateWithModal();case"apple":case"facebook":case"google":case"telegram":case"farcaster":case"line":case"x":case"coinbase":case"discord":return(0,S.f)({authOption:t,client:this.client,ecosystem:this.ecosystem,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow});case"guest":return o({client:this.client,ecosystem:this.ecosystem});case"wallet":return m({ecosystem:this.ecosystem,client:this.client,wallet:e.wallet,chain:e.chain})}}async connect(e){let t=e.strategy;switch(t){case"jwt":return this.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return this.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.loginWithIframe({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{let t=await this.passkeyAuth(e);return this.loginWithAuthToken(t)}case"phone":case"email":case"wallet":case"apple":case"facebook":case"google":case"farcaster":case"telegram":case"line":case"x":case"guest":case"coinbase":case"discord":{let t=await this.authenticate(e);return await this.auth.loginWithAuthToken(t)}default:!function(e,t){throw Error(null!=t?t:"Invalid param: ".concat(e))}(t)}}async logout(){return await this.auth.logout()}async passkeyAuth(e){var t,a,r,s;let{PasskeyWebClient:o}=await Promise.resolve().then(i.bind(i,70901)),l=new o,c=n.x;return"sign-up"===e.type?u({client:this.client,ecosystem:this.ecosystem,username:e.passkeyName,passkeyClient:l,storage:c,rp:{id:null!==(t=this.passkeyDomain)&&void 0!==t?t:window.location.hostname,name:null!==(a=this.passkeyDomain)&&void 0!==a?a:window.document.title}}):h({client:this.client,ecosystem:this.ecosystem,passkeyClient:l,storage:c,rp:{id:null!==(r=this.passkeyDomain)&&void 0!==r?r:window.location.hostname,name:null!==(s=this.passkeyDomain)&&void 0!==s?s:window.document.title}})}constructor({client:e,onAuthSuccess:t,ecosystem:i,passkeyDomain:n}){if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passkeyDomain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(e.clientId))throw Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");let r=(0,a.TS)("inAppWallet");this.client=e,this.ecosystem=i,this.passkeyDomain=n,this.querier=new L({clientId:e.clientId,ecosystem:i,baseUrl:r}),this.auth=new W({client:e,querier:this.querier,baseUrl:r,ecosystem:i,onAuthSuccess:async e=>{if(null==t||t(e),this.ecosystem&&"sharded"===e.storedToken.authDetails.walletType&&!await this.querier.call({procedureName:"migrateFromShardToEnclave",params:{storedToken:e.storedToken}}))throw Error("Failed to migrate from sharded to enclave wallet");if(await this.initializeWallet(e.storedToken.cookieString),!this.wallet)throw Error("Failed to initialize wallet");return await this.wallet.postWalletSetUp({...e.walletDetails,authToken:e.storedToken.cookieString,walletUserId:e.storedToken.authDetails.userWalletId}),"enclave"!==e.storedToken.authDetails.walletType&&await this.querier.call({procedureName:"initIframe",params:{partnerId:null==i?void 0:i.partnerId,ecosystemId:null==i?void 0:i.id,clientId:this.client.clientId,deviceShareStored:"deviceShareStored"in e.walletDetails?e.walletDetails.deviceShareStored:null,walletUserId:e.storedToken.authDetails.userWalletId,authCookie:e.storedToken.cookieString}}),{user:{status:y.Nx.LOGGED_IN_WALLET_INITIALIZED,authDetails:e.storedToken.authDetails,account:await this.wallet.getAccount(),walletAddress:e.walletDetails.walletAddress}}}})}}}}]);