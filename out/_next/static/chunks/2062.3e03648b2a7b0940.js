"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2062],{2062:function(e,t,a){a.d(t,{relayEngineTransaction:function(){return u}});var n=a(47275),r=a(49859),s=a(94293),o=a(46510);async function i(e){let{account:t,serializableTransaction:a,transaction:r,gasless:o}=e,i=(0,n.u)({address:o.relayerForwarderAddress,chain:r.chain,client:r.client}),u=await (0,s.readContract)({contract:i,method:"function getNonce(address) view returns (uint256)",params:[t.address]}),[d,h]=await (async()=>{var e,n;if(!a.to)throw Error("engine transactions must have a 'to' address");if(!a.gas)throw Error("engine transactions must have a 'gas' value");if(!a.data)throw Error("engine transactions must have a 'data' value");if(o.experimentalChainlessSupport){let e={from:t.address,to:a.to,value:0n,gas:a.gas,nonce:u,data:a.data,chainid:BigInt(r.chain.id)};return[await t.signTypedData({domain:{name:"GSNv2 Forwarder",version:"0.0.1",verifyingContract:i.address},message:e,primaryType:"ForwardRequest",types:{ForwardRequest:l}}),e]}let s={from:t.address,to:a.to,value:0n,gas:a.gas,nonce:u,data:a.data};return[await t.signTypedData({domain:{name:null!==(e=o.domainName)&&void 0!==e?e:"GSNv2 Forwarder",version:null!==(n=o.domainVersion)&&void 0!==n?n:"0.0.1",chainId:r.chain.id,verifyingContract:i.address},message:s,primaryType:"ForwardRequest",types:{ForwardRequest:c}}),s]})();return{message:h,signature:d,messageType:"forward"}}let c=[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"gas",type:"uint256"},{name:"nonce",type:"uint256"},{name:"data",type:"bytes"}],l=[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"gas",type:"uint256"},{name:"nonce",type:"uint256"},{name:"data",type:"bytes"},{name:"chainid",type:"uint256"}];async function u(e){let{message:t,messageType:a,signature:n}=await i(e),s=await fetch(e.gasless.relayerUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,r.P)({request:t,type:a,signature:n,forwarderAddress:e.gasless.relayerForwarderAddress})});if(!s.ok)throw Error("Failed to send transaction: ".concat(await s.text()));let o=await s.json();if(!o.result)throw Error("Relay transaction failed: ".concat(o.message));let c=o.result.queueId,l=Date.now()+6e4;for(;Date.now()<l;){let t=await d({options:e,queueId:c});if(t)return{transactionHash:t.transactionHash,chain:e.transaction.chain,client:e.transaction.client};await new Promise(e=>setTimeout(e,1e3))}throw Error("Failed to find relayed transaction after ".concat(6e4,"ms"))}async function d(e){let{options:t,queueId:a}=e,n=t.gasless.relayerUrl.split("/relayer/")[0],r=await fetch("".concat(n,"/transaction/status/").concat(a),{method:"GET"}),s=await r.json();if(!r.ok)return null;let i=s.result;if(!i)return null;switch(i.status){case"errored":throw Error("Transaction errored with reason: ".concat(i.errorMessage));case"cancelled":throw Error("Transaction execution cancelled.");case"mined":return await (0,o.h)({client:t.transaction.client,chain:t.transaction.chain,transactionHash:i.transactionHash});default:return null}}},46510:function(e,t,a){a.d(t,{h:function(){return h}});var n=a(55936),r=a(56547);let s={"0x0":"reverted","0x1":"success"};async function o(e,t){let a=await e({method:"eth_getTransactionReceipt",params:[t.hash]});if(!a)throw Error("Transaction receipt not found.");return function(e){let t={...e,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs?e.logs.map(e=>(function(e){let{args:t,eventName:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{...e,blockHash:e.blockHash?e.blockHash:null,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,logIndex:e.logIndex?Number(e.logIndex):null,transactionHash:e.transactionHash?e.transactionHash:null,transactionIndex:e.transactionIndex?Number(e.transactionIndex):null,...a?{args:t,eventName:a}:{}}})(e)):null,to:e.to?e.to:null,transactionIndex:e.transactionIndex?(0,n.ly)(e.transactionIndex):null,status:e.status?s[e.status]:null,type:e.type?r.c8[e.type]||e.type:null};return e.blobGasPrice&&(t.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(t.blobGasUsed=BigInt(e.blobGasUsed)),t}(a)}var i=a(90874),c=a(14520);async function l(e){let t=await e({method:"eth_blockNumber"});return(0,c.y_)(t)}let u=new Map,d=new Map;function h(e){var t;let{transactionHash:a,chain:n,client:r}=e,s=n.id,c="".concat(s,":tx_").concat(a),h=null!==(t=e.maxBlocksWaitTime)&&void 0!==t?t:30;if(d.has(c))return d.get(c);let f=new Promise((e,t)=>{a||t(Error("Transaction has no transactionHash to wait for, did you execute it?"));let s=(0,i.getRpcClient)({client:r,chain:n}),c=-1,d=function(e){let{client:t,chain:a,onNewBlockNumber:n,overPollRatio:r,latestBlockNumber:s,onError:o}=e,c=a.id,d=u.get(c);return d||(d=function(e,t,a,n){let r,s,o=[],c=[],u=!1,d=(0,i.getRpcClient)({client:e,chain:t});async function h(){var e;if(!u)return;try{let e=await l(d);if(!r||e>r){let t=[];if(r)for(let a=r+1n;a<=e;a++)t.push(BigInt(a));else t=[e];r=e;let a=new Date().getTime();if(s){let e=(a-s)/t.length;c.push(e),c=c.slice(-10)}for(let e of(s=a,t))for(let t of o)t(e)}}catch(e){n?n(e):console.error("[watchBlockNumber]: Failed to poll for latest block number: ".concat(e))}let t=function(e){for(;e.length<10;)e.unshift(1e3);return e.reduce((e,t)=>e+t,0)/e.length}(c);await (e=Math.max(500,Math.min(5e3,Math.max(500,t)))/(null!=a?a:2),new Promise(t=>setTimeout(t,e))),h()}return function(e,t){return o.push(e),u||(r=t,u=!0,h()),function(){0===(o=o.filter(t=>t!==e)).length&&(r=void 0,s=void 0,u=!1)}}}(t,a,r,o),u.set(c,d)),d(n,s)}({client:r,chain:n,onNewBlockNumber:async()=>{if(++c>=h){d(),t(Error("Transaction not found after ".concat(h," blocks")));return}try{let t=await o(s,{hash:a});d(),e(t)}catch(e){}}})}).finally(()=>{d.delete(c)});return d.set(c,f),f}}}]);